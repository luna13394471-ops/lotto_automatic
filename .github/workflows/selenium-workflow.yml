name: Lotto Auto Purchase

on:
  workflow_dispatch: # ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰
  schedule:
    # ë§¤ì£¼ ì›”ìš”ì¼ KST 07:50 (UTC 22:50)ì— ì‹¤í–‰ë¨
    # 0 (ì¼ìš”ì¼) 22ì‹œ 50ë¶„ì€ í•œêµ­ ì‹œê°„ ì›”ìš”ì¼ 07ì‹œ 50ë¶„ì…ë‹ˆë‹¤. (UTC +9)
    - cron: '50 22 * * 0' 
    
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      # ìµœì‹  v4 ë²„ì „ ì‚¬ìš©
      uses: actions/checkout@v4

    - name: Set up Python
      # ìµœì‹  v5 ë²„ì „ ì‚¬ìš©
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: Install dependencies (Python & System)
      run: |
        python -m pip install --upgrade pip
        # ğŸš¨ ì¤‘ìš” ìˆ˜ì •: requests ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€
        pip install selenium requests
        
        # Chrome/Selenium ì‹¤í–‰ì— í•„ìš”í•œ ìµœì†Œí•œì˜ ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
        sudo apt-get update
        sudo apt-get install -y libglib2.0-0 libnss3 libfontconfig1 libxss1
        
    - name: Install Google Chrome Stable
      run: |
        # Google Chrome ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜
        wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        sudo dpkg -i google-chrome-stable_current_amd64.deb || sudo apt-get install -f -y
        
    - name: Run Selenium Script
      # ğŸš¨ ì¤‘ìš” ìˆ˜ì •: í…”ë ˆê·¸ë¨ í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€
      env: 
        LOTTO_ID: ${{ secrets.LOTTO_ID }}
        LOTTO_PASSWORD: ${{ secrets.LOTTO_PASSWORD }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: python main.py
